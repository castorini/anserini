/*
 * Anserini: A Lucene toolkit for reproducible information retrieval research
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package io.anserini.encoder.dense;

import ai.onnxruntime.OrtException;
import org.junit.Test;

import java.io.IOException;
import java.net.URISyntaxException;

import static org.junit.Assert.assertTrue;

public class CosDprDistilEncoderInferenceTest extends DenseEncoderInferenceTest {
  static private final String MODEL_URL = "https://rgw.cs.uwaterloo.ca/pyserini/data/cosdpr-distil-optimized.onnx";
  static private final String MODEL_NAME = "cosdpr-distil-optimized.onnx";

  private static final DenseExampleOutputPair[] EXAMPLES = {
      new DenseExampleOutputPair(
          "In the dawn of the 21st century, humanity stands on the brink of one " +
              "of the most transformative periods in history: the rise of artificial " +
              "intelligence (AI). This technological revolution promises to redefine " +
              "the way we live, work, and interact with the world around us. However, " +
              "as with any major technological advancement, the implications of AI for " +
              "society are complex, nuanced, and not entirely predictable. This essay " +
              "explores the potential impacts of AI on various aspects of human life, " +
              "including employment, ethics, personal privacy, and societal structures.",
          new float[] {-0.07182994f, 0.025638469f, 0.005867088f, -0.019393511f, -0.016776744f, 0.02472616f, -0.017166f, -0.012950814f, 0.0377488f, -0.0022798344f, -0.03889247f, 0.043980915f, 0.06583602f, -0.06666326f, -0.058847178f, -0.070658684f, -0.015263639f, 0.0037605339f, 0.010261708f, 0.011565848f, 0.005243536f, 0.005884984f, -0.01879313f, -0.03335202f, -0.078276105f, -0.059861492f, -0.013204131f, 0.004968145f, -0.014449623f, -0.034429517f, 0.02765638f, 0.013353525f, 0.00562145f, 0.036522996f, -0.050400864f, 7.914235E-4f, -0.05015071f, 0.013110062f, -0.043293584f, 0.028137682f, 0.032721415f, 0.022277584f, -0.028872011f, -0.0042282846f, 0.040532768f, 0.044316974f, -0.0041452567f, 0.054315034f, -0.009193344f, 4.71822E-4f, -0.042329777f, -0.016235843f, 0.034199357f, 0.012554921f, -0.011141396f, -0.029018637f, -0.03040759f, 0.03248223f, 0.014333893f, -0.10311619f, 0.006713619f, 0.03898835f, -7.89426E-4f, 0.12230065f, 0.073069915f, 0.037072577f, 0.037946027f, -0.019080011f, -0.032364666f, -0.0037758916f, 0.04805931f, 0.029454414f, -0.04533535f, 0.025562499f, 0.0062672067f, 0.012822208f, -8.549216E-4f, -0.0014613171f, -0.03463803f, -0.01590388f, 0.040040676f, -0.007386415f, -0.00593493f, 0.041221507f, -0.060449492f, 0.002117086f, 0.019120898f, 0.052611414f, -0.04531954f, -0.06385305f, 0.013017133f, 6.383753E-4f, 0.056866873f, -0.05880975f, -0.020197954f, -0.048178036f, 0.0016221124f, -0.0011609219f, -0.08082483f, -0.036942687f, 0.0068923426f, -0.0013938252f, 0.044653896f, 0.0044386815f, 0.061512828f, -0.006652349f, 0.02992891f, 0.008342044f, -0.028344741f, 0.05253018f, -0.019251825f, 0.043467574f, -0.0018950175f, -0.003537357f, 0.022982955f, 0.014883311f, -0.061692312f, -0.029705158f, 0.008535467f, -0.074049175f, -0.006792518f, -0.007787209f, 0.028882943f, -0.0033204916f, -0.059302825f, 0.08332707f, 0.02171955f, -0.050930176f, -0.022350384f, -0.064406075f, -0.032042686f, -0.022511978f, 0.01734318f, 0.04358742f, 0.020613648f, 0.030855253f, -0.02588523f, -0.07103124f, -0.0066506825f, 0.070600696f, -0.025989871f, -0.005003086f, -0.017900953f, -0.019186541f, -0.01896583f, -0.042220592f, 0.032881327f, 0.05251026f, 0.030922826f, 0.02267363f, 0.018870868f, 0.004769912f, 0.013682893f, -0.043894768f, -0.05329361f, 0.05728471f, -0.07905874f, -0.030174378f, 0.016520122f, -0.026486794f, 0.020156793f, -0.04201551f, -0.03671063f, -0.02674655f, 0.066184275f, -0.06466846f, -0.023628376f, 0.055588014f, -0.0039829807f, -0.015007743f, -0.05257027f, 0.015556049f, -0.070034094f, -0.009601395f, 0.01436396f, 0.01749135f, 0.033021756f, -0.033788458f, 0.009059035f, -0.052563183f, 0.0059051947f, 0.00809733f, 0.03675768f, -0.031743724f, -0.032945137f, 0.005820923f, 0.041650064f, -0.008185141f, -0.033683337f, 0.018101022f, 0.04928173f, 0.0056741103f, -0.013374302f, 0.02240781f, -0.0010575623f, -0.042272415f, -0.011471854f, -0.018691916f, 0.044343695f, 0.024527065f, -0.035234593f, 0.009746262f, 0.019704575f, -0.029608268f, -0.030061245f, 0.032212917f, 0.027315862f, -0.027191734f, -0.023293782f, -0.06055387f, -0.032581937f, -0.012147365f, 0.021112049f, -0.09082222f, -0.018695159f, -0.047392465f, -0.049814634f, -0.011934516f, -0.047766555f, -3.3786177E-4f, 0.013265317f, 0.088718586f, -0.0072714426f, -0.054066017f, -0.004295275f, 0.015656197f, 0.005342541f, -0.022705834f, 0.038624275f, 0.027740022f, 0.05711709f, 0.030168965f, -0.0019041332f, 0.0034067878f, 0.0025702028f, -0.070181035f, -0.010516422f, 0.054544087f, 0.016001018f, -0.03188619f, -0.03360882f, -0.0014437516f, 0.0490635f, -1.597545E-4f, -0.006577267f, -0.053688936f, -0.0080956435f, -0.047098044f, -0.04072523f, 0.025773877f, 0.06644057f, 0.053393878f, 0.024528392f, -0.024045536f, -0.052680947f, 0.013403457f, -0.0033177948f, -0.05694673f, -0.030360607f, -0.03628884f, -0.018916845f, 0.025944287f, 0.033906303f, 0.02683545f, -0.01240323f, -0.018010747f, 0.10942066f, 0.015096311f, 0.044921957f, -0.01615221f, 0.031186877f, 0.0024978137f, 0.0028441478f, -0.06579297f, 0.051336598f, 0.059054177f, -0.004880229f, -0.06193258f, 1.2907296E-4f, -0.036178146f, -0.08277087f, 0.0046520457f, -0.01708648f, -0.015088771f, 0.036142606f, -0.019584235f, -0.07144579f, 0.07531386f, 0.033382088f, -0.042452294f, -0.07923111f, 0.018713295f, -0.046418395f, 0.052556768f, -0.044287857f, -0.021068454f, 0.012266173f, 0.0071762605f, 0.0048433915f, -0.043901f, -0.028552793f, -0.0037638063f, -0.03098537f, 0.09067934f, 0.030684855f, -0.015331971f, -0.031137144f, 0.024869898f, -0.032730896f, -0.012308449f, 0.014049603f, -0.024503753f, 0.050988223f, 0.013898275f, 0.027814366f, 0.0058265263f, 0.02923517f, -0.025577545f, -0.026059918f, -0.01101652f, -0.077475406f, 0.077752374f, -0.0347332f, 0.01337241f, -0.0049007926f, -0.019772943f, -0.03382699f, 0.0013077235f, -0.011823386f, -0.029209577f, 0.028955521f, -0.009814858f, -0.012735674f, -0.03594195f, -0.036962368f, 0.034305103f, 0.02611424f, -0.033179108f, -0.04104544f, 0.017682523f, -0.00898824f, -0.026093416f, -0.057393637f, -0.008224311f, 0.06635192f, -0.045887455f, -0.026212158f, 0.012755069f, -0.03335027f, 0.0022212618f, 0.006744332f, 0.027371382f, 0.0058580064f, 0.04445192f, 0.010248081f, -0.008070635f, -2.8921146E-4f, 0.0029472073f, 0.008396338f, -0.024080487f, -0.022213053f, -2.1521717E-4f, -0.008196877f, -0.05524054f, -0.06924025f, -0.0011377962f, 0.017122816f, -0.028003268f, 0.033457976f, -0.07784018f, -0.074723504f, 0.0030324082f, -0.0367062f, -0.020742252f, -0.037435215f, 0.03178386f, -0.063913934f, 0.044924233f, -0.034241162f, 0.0579138f, 0.007886562f, -0.044823896f, 0.0127801085f, 0.023554435f, 0.006941595f, -0.057780914f, 0.057333842f, 0.010572394f, -0.02170245f, -0.019338852f, -0.0997075f, 0.007511952f, -0.021043211f, -0.008946721f, -0.0042022923f, -0.010053809f, 0.034677405f, 0.04942105f, 0.027701689f, -0.017185932f, -0.027324468f, -0.015326927f, -0.011469238f, 0.017400356f, 0.020416433f, -0.01578589f, -0.03299774f, 0.02381043f, -0.0032371879f, -0.009942227f, -0.04060628f, 0.03329374f, 0.042582702f, 0.0534858f, -0.026921978f, -0.07497888f, -0.021532599f, 0.011147657f, -0.043378994f, 0.029698066f, 0.0054624537f, 0.057021387f, -0.011470971f, -0.028507492f, 0.003813082f, 0.0035690153f, 0.06729087f, 0.020330906f, -0.0081096515f, 0.02397356f, -0.010695105f, 0.027311696f, 0.0403631f, 0.11058507f, -0.035720654f, 0.018471977f, 0.021662815f, 0.027645368f, 0.044159427f, 0.0025745158f, -0.03146097f, 0.007639995f, 0.031756002f, 0.051919434f, -0.08581813f, -0.051000673f, 0.032044526f, -0.0040353322f, 0.0480342f, 0.019363238f, 0.055078797f, -0.0065611713f, -0.007001079f, 0.032783344f, -0.036182955f, -0.03797247f, -0.015758336f, 0.05232005f, -0.008046332f, -0.029453011f, -0.06966723f, -0.015611766f, -0.056680854f, -8.907831E-4f, -0.058441557f, 0.020999346f, 0.00453408f, -0.04389744f, 0.03121252f, 0.043262467f, 0.02472057f, 0.014705787f, 0.03387066f, -0.04137237f, -0.033539485f, -0.007493662f, -0.058297873f, -8.020531E-5f, -0.03639449f, -0.072516546f, -0.039029516f, 0.044494294f, 0.014636208f, 0.0023211082f, 0.010178166f, -0.035680816f, 0.034310907f, -0.03562482f, 0.03344331f, 0.009704171f, 0.03277706f, -0.023614103f, 0.020330658f, 0.036500208f, 0.0063526486f, -0.025237858f, 0.02771095f, -0.04922829f, 4.898582E-4f, -0.013252627f, 0.027894387f, -0.0121024065f, -0.0038891546f, 0.05180404f, 0.049092952f, 0.012687317f, 0.026700107f, -0.016476428f, -0.0075687543f, 0.04776513f, -0.046579942f, 0.008784597f, 0.018222084f, 0.00967907f, -0.013329287f, -0.024506483f, -0.0038507425f, -0.007544446f, 1.5027396E-4f, 0.0627644f, -0.020113263f, -0.014455865f, -0.005401138f, 0.0046793194f, 0.028049149f, -0.041322596f, -0.019771332f, -0.030237507f, -0.020433571f, 0.008996776f, 0.0056302166f, -0.023741098f, -0.0070669f, 0.017820418f, -0.03412024f, -0.04831869f, -0.011154852f, 0.01469234f, 0.004374447f, 0.0074482886f, 0.0443056f, -8.82093E-4f, -0.04822631f, -0.018821606f, -0.091527656f, 0.016821785f, 6.1412225E-4f, -0.0112690525f, 0.038445096f, -0.05009376f, -0.006495683f, -0.030169025f, 0.021500122f, 0.06402759f, 0.04329873f, -0.0025083697f, -0.051239964f, -0.018672273f, 0.009386103f, 0.10314068f, 0.012127738f, -0.019771557f, -0.017247431f, -0.026035324f, -0.06751369f, -0.030769225f, 0.030563764f, 0.028171673f, 0.058008697f, 0.03545082f, -0.025716288f, 0.07414027f, -0.06019358f, -0.0013726655f, -0.0072784973f, 0.0195666f, 0.009670343f, 6.199445E-4f, -0.026085855f, -0.024281314f, 0.008795932f, 0.013455398f, -0.013067899f, -0.01875217f, 0.019114532f, -0.029691624f, 0.013247819f, 7.25843E-4f, -0.009202455f, 0.040359557f, -0.04372521f, 0.04772709f, 0.04477289f, -0.012948663f, 0.041927155f, 0.008771062f, -0.06886936f, -0.08105311f, 0.013360978f, 0.032937255f, -0.050666053f, -0.018394772f, 0.0046934406f, -0.028184194f, -0.041776247f, 0.06701001f, 0.014561258f, -0.009416533f, 0.03442622f, 0.031998213f, 0.017667511f, 0.039084945f, 0.030383771f, 0.030318933f, 0.008415416f, -0.01724892f, -0.004780431f, 0.11708565f, -0.014255822f, -0.012667724f, -0.040456537f, -0.047957104f, -0.01670462f, 0.03882266f, 0.019295784f, -0.013319217f, -0.07793281f, 0.040841397f, -0.049810458f, -0.06093066f, 0.043243803f, -0.06232833f, -0.032621108f, 0.02609278f, 0.0023316925f, 0.015314254f, 0.059133742f, 0.01899603f, 0.040993452f, -0.013128398f, -0.040942248f, 0.042994108f, -0.040927213f, 0.021850232f, -0.014590851f, -0.031606052f, 0.012753955f, 0.021685453f, -0.05864607f, -0.0052641477f, -0.08946817f, -0.039596975f, -0.03559032f, -0.017131051f, 0.03749526f, -0.025938481f, 0.022898737f, 0.024935203f, -0.018146824f, -0.021448752f, -9.0288837E-4f, -0.022760408f, -0.07888276f, 0.0127199385f, -0.022284852f, -0.025053887f, -0.06309791f, 0.071372606f, 0.04204877f, 0.016885875f, 0.0044902544f, 0.02923991f, 0.0221178f, 0.019824306f, 0.010853452f, 0.0018667803f, -0.0022232449f, -8.497298E-5f, -0.007883721f, -0.04736438f, -0.009825733f, 0.0077811703f, 0.009753708f, -0.036547102f, 0.010490924f, 0.0055760397f, -0.0054027108f, -0.046180774f, -0.014775707f, -0.049316682f, -0.02131589f, -0.0046215425f, -0.077907436f, -0.015723208f, 0.007820096f, 0.045149818f, -0.052708026f, -0.008958009f, 0.035408836f, -0.009046142f, -0.020093692f, -0.0012776444f, -0.020524455f, -0.010109378f, 0.021320507f, 0.028127966f, -0.038761478f, -0.057541586f, 0.031414542f, 0.03821912f, 0.042468008f, -0.06139748f, 0.012023797f, 0.005007364f, 0.041004874f, -0.04293362f, 0.015052501f, -0.0041325674f, -0.051884234f, 0.008181912f, 0.074247845f, 0.03608059f, -0.03363531f, 0.068166636f, 0.024201235f, 0.018454088f, -0.0028808557f, 0.016842308f, 0.04275873f, -0.009106458f, 0.035213f, -0.020948661f, 0.025817953f, 0.026684895f, 0.024041023f, -0.0057410803f, 0.023930607f, 0.0066470467f, -0.019417565f, 0.010378571f, -0.038020916f, 0.014676114f, 0.06018564f, -0.011222354f, -0.011842009f, 0.009828923f, -0.008317897f, -0.014582023f, 0.041709974f, -0.038374763f, -0.00994659f, -0.025623646f, -0.02513423f, 0.021082101f, -0.005393574f, -0.020522479f, -0.0021371227f, 0.03415675f, 0.015911538f, 0.04990707f, 0.02090381f, 0.0047748187f, 0.06527955f, 0.017306583f, 0.051095508f, 0.027828986f, 0.018874817f, 0.020783026f})
  };

  @Test
  public void testExamples() throws OrtException, IOException, URISyntaxException {
    try(CosDprDistilEncoder encoder = new CosDprDistilEncoder()) {
      assertTrue(encoder.getModelPath().endsWith("cosdpr-distil-optimized.onnx"));
      super.testExamples(EXAMPLES, encoder);
    }
  }
}
